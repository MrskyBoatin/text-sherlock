{% extends "base.tpl" %}

{% block header %}
<script src='/static/js/search.js'></script>
{% if type == 'docs' %}
<scrip src='/static/js/docs-manage.js'></script>
{% endif %}
{% endblock %}

{% block content %}
<form action="/search" method="GET">
    <div>
        <!--<label for="text">Text</label>-->
        <input type="text"
               class="field"
               name="q"
               autocomplete="off"
               autocorrect="off"
               value="{{ search_text }}"
               {% if type == 'docs' %}
               placeholder="Search documents"
               {% else %}
               placeholder="Search text"
               {% endif %}
               id="text" />
        {% if type == 'docs' and projects %}
        <select name="project">
            <option value='all'>All</option>
            {% for project in projects %}
            <option value='{{ project.id }}'>{{ project.name }}</option>
            {% endfor %}
        </select>
        {% endif %}
    </div>

    <!--<div>
        <label for="path">Path</label>
        <input type="text"
               class="field"
               name="path"
               value="{{ path }}"
               id="path">
    </div>-->
    <div>
        <input type="submit"
               value="Search"
               class="btn btn-primary"
               id="submit" />
        <a href='/' class="clear-btn">clear</a>
    </div>

    {% if search_text %}
    <h4>Page <em>{{ page.current }}</em> of <em>{{ total_count }}</em> Results</h4>
    {% endif %}

    {% include "pagination.tpl" %}

    <div id="results">
        {% if results %}
        {% for item in results %}
        <div class='result' data-src="{{ item.result.index_path }}">
            <div class="filename">
                <a href='/document?path={{ item.result.index_path|urlencode }}&q={{ search_text }}&p={{ page.current }}'>/{{ item.result.index_path }}</a>
            </div>
            <div class="syntax">
                <pre>{{ item.html|safe|trim }}</pre>
            </div>
        </div>
        {% endfor %}
        {% elif page %}
        Your search - {{ search_text }} - did not match any documents{% if page.current > 1 %} for page {{ page.current }}{% endif %}.
        {% endif %}
    </div>
</form>

{% include "pagination.tpl" %}

<div id='last-indexed'>
    Indexes updated {{ last_indexed }}
</div>
{% endblock %}